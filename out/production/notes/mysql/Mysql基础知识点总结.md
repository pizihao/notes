# MySql基础知识点总结

1. net start mysql 启动mysql服务，start后边跟的是服务名
2. sc delete mysql 清空服务
3. mysql -uroot -p[密码] 命令行连接
4. use school 切换数据库 use 数据库名
5. show tables 查看数据库中所有的表
6. describe student  显示数据库中所有的表的信息

### 数据表的类型

~~~sql
-- 关于数据库引擎
/*
INNODB 默认使用
MYISAM 早些年使用
*/
~~~

|            | MYISAM | INNODB       |
| ---------- | ------ | ------------ |
| 事务支持   | 不支持 | 支持         |
| 数据行锁定 | 不支持 | 支持         |
| 外键约束   | 不支持 | 支持         |
| 全文索引   | 支持   | 不支持       |
| 表空间大小 | 较小   | 较大 约为2倍 |

- MYISAM 节约空间，速度较快
- INNODB 安全性高，事务的处理，多表多用户操作

> 再物理空间存在的位置

所有的数据库文件都存在data目录下，一个文件夹对应一个数据库

本质还是文件的存储

MySQL数据库

- InnoDB 在数据库表中只有一个*.frm

  文件，以及上级目录下的ibdata1文件

- MyIsam 对应的文件

  - *.frm     表结构的定义文件
  - *.MYD   数据文件（data）
  - *.MYI     索引文件（index）

> 设置数据库表的字符集编码

~~~sql
CHARSET=utf-8
~~~

不设置的话，会使用mysql默认的字符集编码（不支持中文）

### 修改删除表

> 修改

~~~sql
-- 修改表名 ：ALERT TABLE 旧表名 RENAME AS 新表名
-- 增加表的字段 ： ALERT TABLE 表名 ADD 字段名 列属性

-- 修改表的字段（重命名，修改约束）
-- ALTER TABLE 表名 MODIFY 字段名 列属性[]
ALTER TABLE teacherl MODIFY age VARCHAR(11) -- 修改约束
-- ALTER TABLE 表名 CHANGE 旧名字 新名字 列属性[]
ALTER TABLE teacherl CHANGE age age1 INT(1) -- 字段重名名

-- 删除表的字段
-- ALERT TABLE 表名 DROP 字段名
ALERT TABLE teacher DROP age1
~~~

> 删除表

~~~SQL
--删除表(如果表存在再删除)
DROP TABLE IF EXISTS teacherl
~~~

==所有创建和删除操作尽量加上判断，以免报错==

> 注意点

- `` 字段名，使用这个包裹
- 注释 -- /**/
- sql 关键字大小写不敏感，建议使用小写
- 所有的符号全部用英文

### join

1. left join
2. right join
3. inner join

> 思路

1. 分析需求，分析查询的字段来自哪些表，(连接查询)
2. 确定使用哪种连接查询? 7种确定交叉点(这两个表中哪个数据是相同的)
3. 判断的条件:学生表的中 studentNo =成绩表studentNo

| 操作       | 描述                                       |
| ---------- | ------------------------------------------ |
| Inner join | 如果表中至少有一个匹配，就返回行           |
| left join  | 会从左表中返回所有的值，即使右表中没有匹配 |
| right      | 会从右表中返回所有的值，即使左表中没有匹配 |

join on 连接查询

where 等值查询

> SELECT语法

~~~sql
SELECT [ALL | DISTINCT]
{| table.* | [table.fieldI[as alias1][,table.field2[as alia2][....]]}
      FROM table.name [as table_alias]
      [1eft | right | inner join table.name2] -- 联合查询
      [MHERE ... ]-- 指定结果需满足的条件
      [GROUP BY ..] -- 指定结果按照哪几个字段来分组
      [HAVING] -- 过滤分组的记录必须满足的次要条件
      [ORDER BY ...] -- 指定查询记录按一一个或多个条件排序
      [LIMIT ([offset,]row. .count| rom.countoFFSET offset}];--指定查询的记录从哪条至哪条
~~~

==注意:[]括号代表可选的. { )括号代表必选得==

### 事务

#### 什么是事务

将一组sql放在一个批次中去执行

> 事务的四个特性 ACID

- 原子性(Atomicity)：

  事务的原子性指的是，事务中包含的程序作为数据库的逻辑工作单位，它所做的对数据修改操作要么全部执行，要么完全不执行。

- 一致性(Consistency) ：

  一个事务中，事务前后数据的完整性必须保持一致。

- 隔离性(Isolation)：

  事务的隔离性是指多个用户并发访问数据库时，一个用户的 事务不能被其它用户的事务所干扰，多个并发事务之间数据要相互隔离。

- 持久性（Durability)：

- 持久性是指一个事务一旦被提交，它对数据库中数据的改变 就是永久性的，接下来即使数据库发生故障也不应该对其有任何影响。

> 如何实现数据库的事务

- 原子性实现：

  为了实现原子性，需要通过日志：将所有对数据的更新操作都写入日志。如果一个事务中的一部分操作已经成功，但以后的操作，由于断电/系统崩溃/其它的软硬件错误而无法继续，则通过回溯日志，将已经执行成功的操作撤销，从而达到“全部操作失败”的目的

- 一致性实现：

  应用层定义的完整性约束

- 隔离性实现：

  使用锁

- 永久性实现：

  每条日志记录会产生一个递增的日志号，事务提交之前，日志已经刷到磁盘上。发生故障时，读取日志进行REDO（重演将所有已经执行成功但尚未写入到磁盘的操作，保证持久性。

### 索引

>索引(Index)是帮助MySQL高效获取数据的数据结构。
>提取句子主干，就可以得到索引的本质:索引是数据结构。

>索引是帮助数据库高效获取数据的数据结构。索引的实现通常使用B树及其变种B+树。
>为表设置索引要付出代价的：一是增加了数据库的存储空间，二是在插入和修改数据时要花费较多的时间(因为索引也要随之变动)。

B-Tree 是最常用的用于索引的数据结构。因为它们是时间复杂度低， 查找、删除、插入操作都可以可以在对数时间内完成。另外一个重要原因存储在B-Tree中的数据是有序的。
哈希表是另外一种你可能看到用作索引的数据结构-这些索引通常被称为哈希索引。使用哈希索引的原因是，在寻找值时哈希表效率极高。所以，如果使用哈希索引，对于比较字符串是否相等的查询能够极快的检索出的值。



- 主键索引(PRIMARY KEY)
  - 唯一的标识，主键不可重复，只能有一个列作为索引
- 唯一索引(UNIOUE KEY)
  - 避免重复的列出现，唯一索引可以重复，多个列都可以标识为唯一索引
- 常规索引(KEY/INDEX)
  - 默认的，index，key关键字来设置
- 全文索引(FullText)
  - 在特定的数据库引擎下才有，MyISAM
  - 快速定位数据

> 索引的使用

- 在创建表的时候给字段增加索引
- 创建完毕后，增加索引

> show index from table

> 索引的优化

1. 最左前缀匹配原则
2. 对 where,on,group by,order by 中出现的列使用索引
3. 尽量选择区分度高的列作为索引
4. 对较小的数据列使用索引,这样会使索引文件更小
5. 对于like查询，”%”不要放在前面。

> 什么时候不是用索引

1. 查询中很少使用到的列 不应该创建索引,如果建立了索引然而还会降低mysql的性能和增大了空间需求.
2. 很少数据的列也不应该建立索引,比如 一个性别字段 0或者1,在查询中,结果集的数据占了表中数据行的比例比较大,mysql需要扫描的行数很多,增加索引,并不能提高效率
3. 定义为text和image和bit数据类型的列不应该增加索引,
4. 当表的修改(UPDATE,INSERT,DELETE)操作远远大于检索(SELECT)操作时不应该创建索引,这两个操作是互斥的关系
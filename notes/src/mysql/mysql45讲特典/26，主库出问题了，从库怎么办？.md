主库出问题了，从库怎么办？

- 一主多从的设置，一般用于读写分离，主库负责所有的写入和一部分读，其他的读请求则由从库分担。

- 当一个主库宕机后，要重新分配一个主库，这个时候上一个主库的所有从库都要"感知"到这个新的主库，并切换回来

- 基于位点的主备切换

  - 因为切换的时候获取位点的位置并不准确，为了不丢数据，所以会选取日志位点稍靠前些的位置。

  - 这个时候，日志和准确位点之间的事务是已经执行过的，再执行的时候可能会出现一些错误，如主键冲突

  - 通常情况下，我们在切换任务的时候，要先主动跳过这些错误，有两种方法

    - 主动跳过一个事务。跳过命令的写法是：

    - ~~~SQL
      set global sql_slave_skip_counter=1;start slave;
      ~~~

    - 另外一种方式是，通过设置 slave_skip_errors 参数，直接设置跳过指定的错误

      - 1062 错误是插入数据时唯一键冲突；
      - 1032 错误是删除数据时找不到行。

- GTID Global Transaction Identifier

- 全局事务 ID，是一个事务在提交的时候生成的，是这个事务的唯一标识。

  - 由两部分组成 GTID=server_uuid:gno
  - server_uuid 是一个实例第一次启动时自动生成的，是一个全局唯一的值；
  - gno 是一个整数，初始值是 1，每次提交事务的时候分配给这个事务，并加 1。

- 基于 GTID 的主备切换
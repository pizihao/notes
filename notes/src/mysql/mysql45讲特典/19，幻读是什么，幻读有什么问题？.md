幻读是什么，幻读有什么问题？

- 对于一条语句select *  from A where c = 1 for update
- 这里使用了for update说明使用到了写锁，根据两阶段锁协议，这个锁是要在事务完成之后释放的
- 幻读：幻读指的是一个事务在前后两次查询同一个范围的时候，后一次查询看到了前一次查询没有看到的行。
- 在可重复读隔离级别下，普通的查询是快照读，是不会看到别的事务插入的数据的。因此，幻读在“当前读”下才会出现
- 即使把所有的记录都加上锁，还是阻止不了新插入的记录，这也是为什么“幻读”会被单独拿出来解决的原因。
- 产生幻读的原因是，行锁只能锁住行，但是新插入记录这个动作，要更新的是记录之间的“间隙”。因此，为了解决幻读问题，InnoDB 只好引入新的锁，也就是间隙锁 (Gap Lock)。
- 间隙锁，锁的就是两个值之间的空隙
- 跟间隙锁存在冲突关系的，是“往这个间隙中插入一个记录”这个操作。间隙锁之间都不存在冲突关系。
- InnoDB 给每个索引加了一个不存在的最大值 supremum
- 如果要查找的行不存在，就会在已有的数据上的范围内加上间隙锁。
- 间隙锁的引入，可能会导致同样的语句锁住更大的范围，这其实是影响了并发度的
- 间隙锁是在可重复读隔离级别下才会生效的。所以，你如果把隔离级别设置为读提交的话，就没有间隙锁了


为什么我的MySQL会“抖”一下？

- InnoDB在处理更新语句的时候，只做了写日志最后一个磁盘操作，这个日志叫做redolog重做日志，这个过程有两布，更新内存和写redolog
- 当内存数据页跟磁盘数据页内容不一致的时候，我们称这个内存页为“脏页”。内存数据写入到磁盘后，内存和磁盘上的数据页的内容就一致了，称为“干净页”。
- 脏页上的数据刷到磁盘上成为干净页的的过程称之为flush
- 当内存不足或者redolog写满的时候都会发生flush
- 当要读入的数据页没有在内存的时候，就必须到缓冲池中申请一个数据页。这时候只能把最久不使用的数据页从内存中淘汰掉：如果淘汰的是一个干净页，就直接释放出来复用；但如果是脏页呢，就必须将脏页先刷到磁盘，变成干净页后才能复用。
- 所以，刷脏页虽然是常态，但是出现以下这两种情况，都是会明显影响性能的：
  - 一个查询要淘汰的脏页个数太多，会导致查询的响应时间明显变长；
  - 日志写满，更新全部堵住，写性能跌为 0，这种情况对敏感业务来说，是不能接受的。
  - 所以，InnoDB 需要有控制脏页比例的机制，来尽量.避免上面的这两种情况。

> InnoDB 刷脏页的控制策略

- 告知mysql系统的IO性能，让mysql在刷脏页的时候能够知道用多大的力去刷，保证性能的时候同时保证系统稳定。
- InnoDB 的刷盘速度就是要参考脏页比例和redo log 写盘速度。
- 一旦一个查询请求需要在执行过程中先 flush 掉一个脏页时，这个查询就可能要比平时慢了。而 MySQL 中的一个机制，可能让你的查询会更慢：在准备刷一个脏页的时候，如果这个数据页旁边的数据页刚好是脏页，就会把这个“邻居”也带着一起刷掉；而且这个把“邻居”拖下水的逻辑还可以继续蔓延，也就是对于每个邻居数据页，如果跟它相邻的数据页也还是脏页的话，也会被放到一起刷。
- 在 InnoDB 中，innodb_flush_neighbors 参数就是用来控制这个行为的，值为 1 的时候会有上述的“连坐”机制，值为 0 时表示只会刷自己
- 把临近的页也刷新是为了顺序IO，减少随机IO


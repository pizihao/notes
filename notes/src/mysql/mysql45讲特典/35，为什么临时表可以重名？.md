为什么临时表可以重名？

- 临时表和内存表
  - 内存表，指的是使用 Memory 引擎的表，建表语法是 create table … engine=memory。这种表的数据都保存在内存里，系统重启的时候会被清空，但是表结构还在。除了这两个特性看上去比较“奇怪”外，从其他的特征上看，它就是一个正常的表。
  - 临时表，可以使用各种引擎类型 。如果是使用 InnoDB 引擎或者 MyISAM 引擎的临时表，写数据的时候是写到磁盘上的。当然，临时表也可以使用 Memory 引擎。
- 临时表的特性
  - 建表语法是 create temporary table …。
  - 一个临时表只能被创建它的 session 访问，对其他线程不可见。
  - 临时表可以与普通表同名。session A 内有同名的临时表和普通表的时候，show create 语句，以及增删改查语句访问的是临时表。
  - show tables 命令不显示临时表。
- 临时表只能被创建它的 session 访问，所以在这个 session 结束的时候，会自动删除临时表。
- 临时表很适合join优化
  - 不同session的临时表是可以同名的，如果有多个session同时执行join优化，不需要担心表名重复导致建表失败的问题
  - 不需要担心数据删除的问题，临时表中的数据会自动回收
- 临时表可以被应用到数据库的分库分表中
- 为什么临时表可以重名
  - 当我们执行`create temporary table temp_t(id int primary key)engine=innodb;`创建一张临时表的时候，MySQL 要给这个 InnoDB 表创建一个 frm 文件保存表结构定义，还要有地方保存表数据。
  - 这个 frm 文件放在临时文件目录下，文件名的后缀是.frm，前缀是“#sql{进程 id}_{线程 id}_ 序列号”
  - 有关存储数据的方式，在5.6以前是会在临时文件目录下创建一个相同前缀，以.ibd为后缀的文件，在5.7之后mysql会使用一个临时文件表空间，专门存放临时文件的数据
- 每个线程都维护了自己的临时表链表。这样每次 session 内操作表的时候，先遍历链表，检查是否有这个名字的临时表，如果有就优先操作临时表，如果没有再操作普通表；在 session 结束的时候，对链表里的每个临时表，执行 “DROP TEMPORARY TABLE + 表名”操作。
- drop table 命令是可以一次删除多个表的
- 如果当前的 binlog_format=row，那么跟临时表有关的语句，就不会记录到 binlog 里。也就是说，只在 binlog_format=statment/mixed 的时候，binlog 中才会记录临时表的操作。
- 主库不同的线程创建的相同名字的线程在备库是怎么区分的
  - MySQL 在记录 binlog 的时候，会把主库执行这个语句的线程 id 写到 binlog 中。这样，在备库的应用线程就能够知道执行每个语句的主库线程 id，并利用这个线程 id 来构造临时表的 table_def_key



